(function(e,t){var n=e.className("zoom"),r=e.className("zoom-scroller"),i="."+n,s="."+r,o="pinchstart",u="pinch",a="pinchend";"ongesturestart"in t&&(o="gesturestart",u="gesturechange",a="gestureend"),e.Zoom=function(t,n){var r=this;r.options=e.extend(e.Zoom.defaults,n),r.wrapper=r.element=t,r.scroller=t.querySelector(s),r.scrollerStyle=r.scroller&&r.scroller.style,r.zoomer=t.querySelector(i),r.zoomerStyle=r.zoomer&&r.zoomer.style,r.init=function(){e.options.gestureConfig.pinch=!0,e.options.gestureConfig.doubletap=!0,r.initEvents()},r.initEvents=function(t){var n=t?"removeEventListener":"addEventListener",i=r.scroller;i[n](o,r.onPinchstart),i[n](u,r.onPinch),i[n](a,r.onPinchend),i[n](e.EVENT_START,r.onTouchstart),i[n](e.EVENT_MOVE,r.onTouchMove),i[n](e.EVENT_CANCEL,r.onTouchEnd),i[n](e.EVENT_END,r.onTouchEnd),i[n]("drag",r.dragEvent),i[n]("doubletap",r.doubleTapEvent)},r.dragEvent=function(e){(m||h)&&e.stopPropagation()},r.doubleTapEvent=function(e){r.toggleZoom(e.detail.center)},r.transition=function(e,t){return t=t||0,e.webkitTransitionDuration=t+"ms",r},r.translate=function(e,t,n){return t=t||0,n=n||0,e.webkitTransform="translate3d("+t+"px,"+n+"px,0px)",r},r.scale=function(e,t){return t=t||1,e.webkitTransform="translate3d(0,0,0) scale("+t+")",r},r.scrollerTransition=function(e){return r.transition(r.scrollerStyle,e)},r.scrollerTransform=function(e,t){return r.translate(r.scrollerStyle,e,t)},r.zoomerTransition=function(e){return r.transition(r.zoomerStyle,e)},r.zoomerTransform=function(e){return r.scale(r.zoomerStyle,e)};var f=1,l=1,c=!1,h=!1;r.onPinchstart=function(e){h=!0},r.onPinch=function(e){c||(r.zoomerTransition(0),c=!0),f=(e.detail?e.detail.scale:e.scale)*l,f>r.options.maxZoom&&(f=r.options.maxZoom-1+Math.pow(f-r.options.maxZoom+1,.5)),f<r.options.minZoom&&(f=r.options.minZoom+1-Math.pow(r.options.minZoom-f+1,.5)),r.zoomerTransform(f)},r.onPinchend=function(e){f=Math.max(Math.min(f,r.options.maxZoom),r.options.minZoom),r.zoomerTransition(r.options.speed).zoomerTransform(f),l=f,c=!1},r.setZoom=function(e){f=l=e,r.scrollerTransition(r.options.speed).scrollerTransform(0,0),r.zoomerTransition(r.options.speed).zoomerTransform(f)},r.toggleZoom=function(t,n){typeof t=="number"&&(n=t,t=undefined),n=typeof n=="undefined"?r.options.speed:n;if(f&&f!==1)f=l=1,r.scrollerTransition(n).scrollerTransform(0,0);else{f=l=r.options.maxZoom;if(t){var i=e.offset(r.zoomer),s=i.top,o=i.left,u=(t.x-o)*f,a=(t.y-s)*f;this._cal(),u>=E&&u<=E+p?u=E-u+p/2:u<E?u=E-u+p/2:u>E+p&&(u=E+p-u-p/2),a>=S&&a<=S+d?a=S-a+d/2:a<S?a=S-a+d/2:a>S+d&&(a=S+d-a-d/2),u=Math.min(Math.max(u,b),E),a=Math.min(Math.max(a,w),S),r.scrollerTransition(n).scrollerTransform(u,a)}else r.scrollerTransition(n).scrollerTransform(0,0)}r.zoomerTransition(n).zoomerTransform(f)},r._cal=function(){p=r.wrapper.offsetWidth,d=r.wrapper.offsetHeight,x=r.zoomer.offsetWidth,T=r.zoomer.offsetHeight;var e=x*f,t=T*f;b=Math.min(p/2-e/2,0),E=-b,w=Math.min(d/2-t/2,0),S=-w};var p,d,v,m,g,y,b,w,E,S,x,T,N={},C={},k,L,A,O,M,_,D;return r.onTouchstart=function(t){t.preventDefault(),v=!0,N.x=t.type===e.EVENT_START?t.targetTouches[0].pageX:t.pageX,N.y=t.type===e.EVENT_START?t.targetTouches[0].pageY:t.pageY},r.onTouchMove=function(t){t.preventDefault();if(!v)return;if(!m){p=r.wrapper.offsetWidth,d=r.wrapper.offsetHeight,x=r.zoomer.offsetWidth,T=r.zoomer.offsetHeight;var n=e.parseTranslateMatrix(e.getStyles(r.scroller,"webkitTransform"));k=n.x||0,L=n.y||0,r.scrollerTransition(0)}var i=x*f,s=T*f;if(i<p&&s<d)return;b=Math.min(p/2-i/2,0),E=-b,w=Math.min(d/2-s/2,0),S=-w,C.x=t.type===e.EVENT_MOVE?t.targetTouches[0].pageX:t.pageX,C.y=t.type===e.EVENT_MOVE?t.targetTouches[0].pageY:t.pageY;if(!m&&!c)if(Math.floor(b)===Math.floor(k)&&C.x<N.x||Math.floor(E)===Math.floor(k)&&C.x>N.x){v=!1;return}m=!0,g=C.x-N.x+k,y=C.y-N.y+L,g<b&&(g=b+1-Math.pow(b-g+1,.8)),g>E&&(g=E-1+Math.pow(g-E+1,.8)),y<w&&(y=w+1-Math.pow(w-y+1,.8)),y>S&&(y=S-1+Math.pow(y-S+1,.8)),A||(A=C.x),_||(_=C.y),O||(O=e.now()),M=(C.x-A)/(e.now()-O)/2,D=(C.y-_)/(e.now()-O)/2,Math.abs(C.x-A)<2&&(M=0),Math.abs(C.y-_)<2&&(D=0),A=C.x,_=C.y,O=e.now(),r.scrollerTransform(g,y)},r.onTouchEnd=function(e){e.touches.length||(h=!1);if(!v||!m){v=!1,m=!1;return}v=!1,m=!1;var t=300,n=300,i=M*t,s=g+i,o=D*n,u=y+o;M!==0&&(t=Math.abs((s-g)/M)),D!==0&&(n=Math.abs((u-y)/D));var a=Math.max(t,n);g=s,y=u;var l=x*f,c=T*f;b=Math.min(p/2-l/2,0),E=-b,w=Math.min(d/2-c/2,0),S=-w,g=Math.max(Math.min(g,E),b),y=Math.max(Math.min(y,S),w),r.scrollerTransition(a).scrollerTransform(g,y)},r.destroy=function(){r.initEvents(!0),delete e.data[r.wrapper.getAttribute("data-zoomer")],r.wrapper.setAttribute("data-zoomer","")},r.init(),r},e.Zoom.defaults={speed:300,maxZoom:3,minZoom:1},e.fn.zoom=function(t){var n=[];return this.each(function(){var r=null,i=this,s=i.getAttribute("data-zoomer");s?r=e.data[s]:(s=++e.uuid,e.data[s]=r=new e.Zoom(i,t),i.setAttribute("data-zoomer",s)),n.push(r)}),n.length===1?n[0]:n}})(mui,window);