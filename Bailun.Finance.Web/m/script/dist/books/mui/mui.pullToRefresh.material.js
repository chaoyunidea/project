(function(e){var t=e.className("pull-top-tips");e.PullToRefresh=e.PullToRefresh.extend({init:function(t,n){this._super(t,n),this.options=e.extend(!0,{down:{tips:{colors:["008000","d8ad44","d00324","dc00b8","017efc"],size:200,lineWidth:15,duration:1e3,tail_duration:2500}}},this.options),this.options.down.tips.color=this.options.down.tips.colors[0],this.options.down.tips.colors=this.options.down.tips.colors.map(function(e){return{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16)}})},initPullDownTips:function(){var n=this;e.isFunction(n.options.down.callback)&&(n.pullDownTips=function(){var e=document.querySelector("."+t);return e&&e.parentNode.removeChild(e),e||(e=document.createElement("div"),e.classList.add(t),e.innerHTML='<div class="mui-pull-top-wrapper"><div class="mui-pull-top-canvas"><canvas id="pullDownTips" width="'+n.options.down.tips.size+'" height="'+n.options.down.tips.size+'"></canvas></div></div>',e.addEventListener("webkitTransitionEnd",n),document.body.appendChild(e)),n.pullDownCanvas=document.getElementById("pullDownTips"),n.pullDownCanvasCtx=n.pullDownCanvas.getContext("2d"),n.canvasUtils.init(n.pullDownCanvas,n.options.down.tips),e}())},removePullDownTips:function(){this._super(),this.canvasUtils.stopSpin()},pulling:function(e){var t=Math.min(e/(this.options.down.height*1.5),1),n=Math.min(1,t*2);this.pullDownTips.style.webkitTransform="translate3d(0,"+(e<0?0:e)+"px,0)",this.pullDownCanvas.style.opacity=n,this.pullDownCanvas.style.webkitTransform="rotate("+300*t+"deg)";var r=this.pullDownCanvas,i=this.pullDownCanvasCtx,s=this.options.down.tips.size;i.lineWidth=this.options.down.tips.lineWidth,i.fillStyle="#"+this.options.down.tips.color,i.strokeStyle="#"+this.options.down.tips.color,i.stroke(),i.clearRect(0,0,s,s),r.style.display="none",r.offsetHeight,r.style.display="inherit",this.canvasUtils.drawArcedArrow(i,s/2+.5,s/2,s/4,0*Math.PI,5/3*Math.PI*n,!1,1,2,.7853981633974483,25,this.options.down.tips.lineWidth,this.options.down.tips.lineWidth)},beforeChangeOffset:function(e){},afterChangeOffset:function(e){},dragEndAfterChangeOffset:function(e){e?(this.canvasUtils.startSpin(),this.pullDownLoading()):(this.canvasUtils.stopSpin(),this.endPullDownToRefresh())},canvasUtils:function(){function y(e,t,n,r){return n*e/r+t}function b(e,t,n,r){return(e/=r/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t}function w(e,t,n){var r=Math.min(t,n),i=Math.max(t,n);return e<r?r:e>i?r:e}var t=null,n=null,r=200,i=15,s=0,o=0,u=0,a=0,f=0,l=0,c=0,h=180,p=Math.PI/180,d=1e3,v=2500,m=["35ad0e","d8ad44","d00324","dc00b8","017efc"],g=null,E=function(e,t,n,r,i,s,o,u){typeof t=="string"&&(t=parseInt(t)),typeof n=="string"&&(n=parseInt(n)),typeof r=="string"&&(r=parseInt(r)),typeof i=="string"&&(i=parseInt(i)),typeof s=="string"&&(s=parseInt(s)),typeof o=="string"&&(o=parseInt(o));var a=3,f=2*Math.PI;e.save(),e.beginPath(),e.moveTo(t,n),e.lineTo(r,i),e.lineTo(s,o);switch(u){case 0:var l=Math.sqrt((s-t)*(s-t)+(o-n)*(o-n));e.arcTo(r,i,t,n,.55*l),e.fill();break;case 1:e.beginPath(),e.moveTo(t,n),e.lineTo(r,i),e.lineTo(s,o),e.lineTo(t,n),e.fill();break;case 2:e.stroke();break;case 3:var c=(t+r+s)/3,h=(n+i+o)/3;e.quadraticCurveTo(c,h,t,n),e.fill();break;case 4:var p,d,v,m,l,g=5;if(s==t)l=o-n,p=(r+t)/2,v=(r+t)/2,d=i+l/g,m=i-l/g;else{l=Math.sqrt((s-t)*(s-t)+(o-n)*(o-n));var y=(t+s)/2,b=(n+o)/2,w=(y+r)/2,E=(b+i)/2,S=(o-n)/(s-t),x=l/(2*Math.sqrt(S*S+1))/g,T=S*x;p=w-x,d=E-T,v=w+x,m=E+T}e.bezierCurveTo(p,d,v,m,t,n),e.fill()}e.restore()},S=function(e,t,n,r,i,s,o,u,a,f,l,c,h){u=typeof u!="undefined"?u:3,a=typeof a!="undefined"?a:1,f=typeof f!="undefined"?f:Math.PI/8,c=c||1,h=h||10,l=typeof l!="undefined"?l:10,e.save(),e.lineWidth=c,e.beginPath(),e.arc(t,n,r,i,s,o),e.stroke();var p,d,v,m,g;a&1&&(p=Math.cos(i)*r+t,d=Math.sin(i)*r+n,v=Math.atan2(t-p,d-n),o?(m=p+10*Math.cos(v),g=d+10*Math.sin(v)):(m=p-10*Math.cos(v),g=d-10*Math.sin(v)),x(e,p,d,m,g,u,2,f,l)),a&2&&(p=Math.cos(s)*r+t,d=Math.sin(s)*r+n,v=Math.atan2(t-p,d-n),o?(m=p-10*Math.cos(v),g=d-10*Math.sin(v)):(m=p+10*Math.cos(v),g=d+10*Math.sin(v)),x(e,p-h*Math.sin(s),d+h*Math.cos(s),m-h*Math.sin(s),g+h*Math.cos(s),u,2,f,l)),e.restore()},x=function(e,t,n,r,i,s,o,u,a){typeof t=="string"&&(t=parseInt(t)),typeof n=="string"&&(n=parseInt(n)),typeof r=="string"&&(r=parseInt(r)),typeof i=="string"&&(i=parseInt(i)),s=typeof s!="undefined"?s:3,o=typeof o!="undefined"?o:1,u=typeof u!="undefined"?u:Math.PI/8,a=typeof a!="undefined"?a:10;var f=typeof s!="function"?E:s,l=Math.sqrt((r-t)*(r-t)+(i-n)*(i-n)),c=(l-a/3)/l,h,p,d,v;o&1?(h=Math.round(t+(r-t)*c),p=Math.round(n+(i-n)*c)):(h=r,p=i),o&2?(d=t+(r-t)*(1-c),v=n+(i-n)*(1-c)):(d=t,v=n),e.beginPath(),e.moveTo(d,v),e.lineTo(h,p),e.stroke();var m=Math.atan2(i-n,r-t),g=Math.abs(a/Math.cos(u));if(o&1){var y=m+Math.PI+u,b=r+Math.cos(y)*g,w=i+Math.sin(y)*g,S=m+Math.PI-u,x=r+Math.cos(S)*g,T=i+Math.sin(S)*g;f(e,b,w,r,i,x,T,s)}if(o&2){var y=m+u,b=t+Math.cos(y)*g,w=n+Math.sin(y)*g,S=m-u,x=t+Math.cos(S)*g,T=n+Math.sin(S)*g;f(e,b,w,t,n,x,T,s)}},T=function(e,t){var n=e%t;n<f&&m.push(m.shift());var r=m[0],i=m[1],s=w(y(n,r.r,i.r-r.r,t),r.r,i.r),o=w(y(n,r.g,i.g-r.g,t),r.g,i.g),u=w(y(n,r.b,i.b-r.b,t),r.b,i.b);return f=n,"rgb("+parseInt(s)+","+parseInt(o)+","+parseInt(u)+")"},N=function(e){var u=e||(new Date).getTime();o||(o=u),s=u-o,l=b((s+v/2)%v,0,d,v),c=y((s+l)%d,0,360,d),h=20+Math.abs(y((s+v/2)%v,-300,600,v)),n.lineWidth=i,n.lineCap="round",n.strokeStyle=T(s,d),n.clearRect(0,0,r,r),t.style.display="none",t.offsetHeight,t.style.display="inherit",n.beginPath(),n.arc(r/2,r/2,r/4,parseInt(c-h)%360*p,parseInt(c)%360*p,!1),n.stroke(),g=requestAnimationFrame(N)},C=function(){o=0,f=0,g=requestAnimationFrame(N)},k=function(){g&&cancelAnimationFrame(g)},L=function(s,o){t=s,n=t.getContext("2d");var o=e.extend(!0,{},o);m=o.colors,d=o.duration,v=o.tail_duration,r=o.size,i=o.lineWidth};return{init:L,drawArcedArrow:S,startSpin:C,stopSpin:k}}()})})(mui);